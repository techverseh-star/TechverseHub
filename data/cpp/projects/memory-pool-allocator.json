{
  "id": "cpp-3",
  "title": "Memory Pool Allocator",
  "language": "cpp",
  "difficulty": "Advanced",
  "duration": "10-12 hours",
  "description": "Implement a custom memory pool for efficient allocation.",
  "overview": "Build a memory pool that pre-allocates memory for fast object creation.",
  "concepts": [
    "Memory management",
    "Placement new",
    "Templates",
    "RAII"
  ],
  "steps": [
    {
      "title": "Step 1 structure",
      "description": "Design memory pool layout."
    },
    {
      "title": "Step 2",
      "description": "Implement allocate/deallocate."
    },
    {
      "title": "Step 3 construction",
      "description": "Use placement new."
    }
  ],
  "starterCode": "#include <iostream>\n#include <cstdlib>\nusing namespace std;\n\ntemplate<typename T, size_t PoolSize = 100>\nclass MemoryPool {\n    char* pool;\n    bool* used;\n    \npublic:\n    MemoryPool() {\n        pool = new char[sizeof(T) * PoolSize];\n        used = new bool[PoolSize]();\n    }\n    \n    ~MemoryPool() {\n        delete[] pool;\n        delete[] used;\n    }\n    \n    T* allocate() {\n        // TODO free slot and return pointer\n        return nullptr;\n    }\n    \n    void deallocate(T* ptr) {\n        // TODO slot as free\n    }\n};\n\nint main() {\n    MemoryPool<int, 10> pool;\n    int* p = pool.allocate();\n    *p = 42;\n    cout << \"Value: \" << *p << endl;\n    pool.deallocate(p);\n    return 0;\n}\n",
  "solution": "#include <iostream>\n#include <cstdlib>\nusing namespace std;\n\ntemplate<typename T, size_t PoolSize = 100>\nclass MemoryPool {\n    char* pool;\n    bool* used;\n    \npublic:\n    MemoryPool() {\n        pool = new char[sizeof(T) * PoolSize];\n        used = new bool[PoolSize]();\n    }\n    \n    ~MemoryPool() {\n        delete[] pool;\n        delete[] used;\n    }\n    \n    T* allocate() {\n        for (size_t i = 0; i < PoolSize; i++) {\n            if (!used[i]) {\n                used[i] = true;\n                return reinterpret_cast<T*>(pool + i * sizeof(T));\n            }\n        }\n        return nullptr;\n    }\n    \n    void deallocate(T* ptr) {\n        size_t idx = (reinterpret_cast<char*>(ptr) - pool) / sizeof(T);\n        if (idx < PoolSize) used[idx] = false;\n    }\n};\n\nint main() {\n    MemoryPool<int, 10> pool;\n    \n    int* nums[5];\n    for (int i = 0; i < 5; i++) {\n        nums[i] = pool.allocate();\n        *nums[i] = i * 10;\n    }\n    \n    for (int i = 0; i < 5; i++) {\n        cout << *nums[i] << \" \";\n        pool.deallocate(nums[i]);\n    }\n    cout << endl;\n    return 0;\n}\n"
}