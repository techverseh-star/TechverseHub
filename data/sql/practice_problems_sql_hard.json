[
    {
        "id": "sql-h-1",
        "title": "Second Highest Salary",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Return the second highest salary from the employees table. If no second highest exists, return NULL. Use DISTINCT and ORDER BY or window functions.",
        "examples": "SELECT DISTINCT salary FROM employees ORDER BY salary DESC LIMIT 1 OFFSET 1;",
        "solution": "SELECT DISTINCT salary FROM employees ORDER BY salary DESC LIMIT 1 OFFSET 1;",
        "hints": "Offset skips the highest value."
    },
    {
        "id": "sql-h-2",
        "title": "Find Duplicate Rows Using GROUP BY",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Return all email addresses that appear more than once in the users table.",
        "examples": "SELECT email FROM users GROUP BY email HAVING COUNT(*) > 1;",
        "solution": "SELECT email FROM users GROUP BY email HAVING COUNT(*) > 1;",
        "hints": "HAVING filters aggregated groups."
    },
    {
        "id": "sql-h-3",
        "title": "Employees with Higher Salary than Manager",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Using a self join on employees table, return employees who earn more than their manager. employees(id, name, salary, manager_id).",
        "examples": "SELECT e.name FROM employees e JOIN employees m ON e.manager_id = m.id WHERE e.salary > m.salary;",
        "solution": "SELECT e.name FROM employees e JOIN employees m ON e.manager_id = m.id WHERE e.salary > m.salary;",
        "hints": "Use self JOIN with alias."
    },
    {
        "id": "sql-h-4",
        "title": "Top 3 Salaries in Each Department",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Use window functions to get top three salaries partitioned by department.",
        "examples": "ROW_NUMBER() OVER(PARTITION BY dept_id ORDER BY salary DESC)",
        "solution": "SELECT name, dept_id, salary FROM (SELECT *, ROW_NUMBER() OVER(PARTITION BY dept_id ORDER BY salary DESC) AS rn FROM employees) t WHERE rn <= 3;",
        "hints": "Use ROW_NUMBER with PARTITION BY."
    },
    {
        "id": "sql-h-5",
        "title": "Find Longest Employee Tenure",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Return the employee who has been hired earliest. Use MIN(hire_date).",
        "examples": "SELECT * FROM employees ORDER BY hire_date ASC LIMIT 1;",
        "solution": "SELECT * FROM employees ORDER BY hire_date ASC LIMIT 1;",
        "hints": "ORDER BY ascending returns earliest date."
    },
    {
        "id": "sql-h-6",
        "title": "Recursive CTE: Employee Hierarchy",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Using a recursive CTE, list all employees under a given manager id, including indirect reports.",
        "examples": "WITH RECURSIVE emp_tree AS ( base UNION recursive )",
        "solution": "WITH RECURSIVE emp_tree AS ( SELECT id, name, manager_id FROM employees WHERE manager_id = 1 UNION ALL SELECT e.id, e.name, e.manager_id FROM employees e JOIN emp_tree t ON e.manager_id = t.id ) SELECT * FROM emp_tree;",
        "hints": "Use UNION ALL inside recursive CTE."
    },
    {
        "id": "sql-h-7",
        "title": "Products Never Ordered",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Return products that have never been ordered. Tables: products(id), orders(product_id).",
        "examples": "SELECT p.id FROM products p LEFT JOIN orders o ON p.id = o.product_id WHERE o.product_id IS NULL;",
        "solution": "SELECT p.id FROM products p LEFT JOIN orders o ON p.id = o.product_id WHERE o.product_id IS NULL;",
        "hints": "Use LEFT JOIN + NULL filter."
    },
    {
        "id": "sql-h-8",
        "title": "Find Month-wise Sales Total",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Given sales(date, amount), return total sales grouped by month using DATE_FORMAT or EXTRACT.",
        "examples": "SELECT EXTRACT(MONTH FROM date) AS month, SUM(amount) FROM sales GROUP BY month;",
        "solution": "SELECT EXTRACT(MONTH FROM date) AS month, SUM(amount) FROM sales GROUP BY month;",
        "hints": "Use EXTRACT(MONTH...)."
    },
    {
        "id": "sql-h-9",
        "title": "Find Customers Who Ordered Every Product",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Return customers who have ordered all products. Compare count of unique products ordered by customer to total products.",
        "examples": "HAVING COUNT(DISTINCT product_id) = (SELECT COUNT(*) FROM products)",
        "solution": "SELECT customer_id FROM orders GROUP BY customer_id HAVING COUNT(DISTINCT product_id) = (SELECT COUNT(*) FROM products);",
        "hints": "Use COUNT DISTINCT + subquery."
    },
    {
        "id": "sql-h-10",
        "title": "Find Salary Rank",
        "difficulty": "Hard",
        "language": "sql",
        "description": "Use RANK() window function to assign salary ranks to employees.",
        "examples": "RANK() OVER(ORDER BY salary DESC)",
        "solution": "SELECT name, salary, RANK() OVER(ORDER BY salary DESC) AS salary_rank FROM employees;",
        "hints": "RANK handles duplicates unlike ROW_NUMBER."
    }
]